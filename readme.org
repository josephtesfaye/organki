Organki: Combining the magics of Org Mode and Anki!

Organki is a note-taking tool for learning languages.

If you have experience of learning a foreign language you might have written
down a list or lists of words and sentences so that you can somehow memorize all
of them. You might have the same struggle as I did - when the list grows and
(inevitably) branches off to multiple lists of different topics or categories,
things start to get out of hand even if you make a careful curation. Their large
sizes and indefinite amount make the effort of maintenance so immense (the same
goes to anything that piles up) that you start feeling overwhelmed, feeling this
isn't the way to do it, and eventually, quit.

But wait! Here comes Organki!

Now with Organki you can manage your notes using Org Mode and transpose them
into Anki with ease. Well, with that being said, Organki may not be suitable for
everyone (but it strives to be!) because it assumes you use both Org Mode and
Anki, which is the best open-source note-taking tool and spaced-repetition
flashcard software respectively IMHO.

* User Guide
Now let's start using Organki. The first thing you need to know is that if you
want to import your notes into Anki (or anything else) you should write them
down in a set format, which for Organki is just plain lists in Org Mode with
some handy rules.

Organki supports two kinds of lists: *Vocabulary* and *Sentence*. For both kinds of
lists every first-level item is a note, with the same conceptual meaning of an
[[https://docs.ankiweb.net/getting-started.html#notes--fields][Anki note]].

** Vocabulary
:PROPERTIES:
:CUSTOM_ID: 202410092157
:END:

A *Vocabulary* list uses this format:

#+begin_example
- <entry> [<pronunciation>] [<class>] <translation>
  - [<notes>]
#+end_example

- =entry=: A word or phrase that you try to remember.
  The entry should only contain the most common form of the word or phrase, and
  if it has other forms put them in the =A= sub-item under the =notes= section.

- =pronunciation=: How to pronounce this entry. For Japanese entries, it's
  composed of these parts:
  : [<hiragana>] [<accent type>] [<audio file>]

  - =hiragana=: The hiragana reading of the entry. This is only necessary when the
    entry contains Kanji.
    - When the entry contains multiple kanji characters the hiragana characters
      are separated or grouped using middle dots =・= by their kanji readings.

  - =accent type=: The accent type of the reading, e.g. [0], [1], etc. See
    [[p:notes/japanese.org::#20250218230448][Accent type convention]].

  - =audio file=: The audio of the reading, if any.

  For English entries it's composed of these parts:

  : [<IPA>] [<audio file>]

  - =IPA=: The International Phonetics Alphabet pronunciation. Unlike the hiragana
    part, it must be enclosed in a pair of =[...]=, such as =[ˈɡluːkoʊs]=.

  All these parts and the whole pronunciation are optional.

- =class=: The word class, or part of speech of the entry. Abbreviations are
  commonly used for word classes, such as =n.=, =v.=, =adj.=, etc. You can define your
  own set of abbreviations but they must end with a period when in use. For
  example, here is the [[p:notes/japanese.org::parts-of-speech][Japanese Parts of Speech]].

- =translation=: The translation of the entry in the languages you're familiar with.
  - If there are multiple languages they appear in the order below, where
    =primary= is the language you're most familiar with. You can define your own
    order and what matters is to keep consistency.
    : <primary> [<English> <Chinese> ...] [; ...]

  - If there are multiple translations for the entry, separate them with semicolons =;=.
  - For each translation (regardless of language) try to keep it as short and
    precise as possible. Use only one word if possible because these entries are
    meant to be memorized so that you can recall them as quickly as possible. If
    you want to write explanations or notes for the entry you can put them in
    the =notes= sublist.

- =notes=: Additional notes about the entry, which is a sublist of the entry item
  and each item of which starts with a special key and a colon to indicate the
  type of note. The complete keys (or types of notes) are listed below. Unlisted
  keys or items in another format are ignored during [[#20251126120339][exporting]].

  - ~A:~ <alternative forms>

    A single line listing the alternative forms of the entry (same
    pronunciation, different forms).

    For Japanese some conventional symbols as seen in the dictionary [[file:~/projects/notes/japanese.org::#202411121149][Dajirin 4]]
    are supported here to mark something uncommon or less standard about the
    characters. The symbols are listed below:

    - ~^{▽}~: A white down-pointing triangle superscript, meaning the marked
      character's readings (音訓) are not included in the Jōyō Kanji Table
      ([[file:~/projects/notes/japanese.org::#202409272057][常用漢字表]]). For example, 和^{▽}やか.

    - ~〈〉~: A pair of angle brackets enclosing the entry, meaning the reading is
      a Jukujikun (熟字訓) for the entry. For example, 〈今日〉.

  - ~C:~ <comments>

    Explanatory notes or tips about the entry. It may contain a sub-list which
    would then be displayed as-is except the bullet style in the cards' Notes
    fields.

  - ~E:~ <examples>

    Examples that demonstrate the usage of the entry. The format of its contents
    is the same as that of =C:=.

  - ~S:~ <sentences>

    A [[#202410092201][Sentence]] sub-list that demonstrates the usage of the entry, the items of
    which are combined with the contents of =E:= so both of them are displayed
    under the "Examples" sub-notes. The items of this sub-list are also imported
    as new entries, and the main entry will be displayed in the "Vocabulary"
    sub-notes of their "Notes" field. Only the first-level items will display
    the main entry in this way if the sub-list is a multi-level list.

  - ~F:~ <family>

    A Vocabulary sub-list of words or phrases closely related to or belonging to
    the same grammatical family as the entry.

  - ~L:~ <linking>

    A Vocabulary sub-list, are words or phrases related to the entry that may
    assist in your memorization.

Here is a simple Vocabulary list:

#+NAME: TOKYO20251003210207
- 林檎 りんご [0] n. apple
- 蜜柑 みかん [1] [[cl:202410021528.m4a][⏯]] n. mandarin orange

Here is a more comprehensive Vocabulary list:

- 交流 こう·りゅう [0] n. exchange
  - L:
    - 交流会 こう·りゅう·かい [0] n. (cultural) exchange meeting, social gathering
- 会議 かい·ぎ [1] n. meeting, conference
- 客 きゃく [0] n. visitor; guest; customer
  - F:
    - 招かれざる客 まね・かれざる·きゃく phrn. an uninvited visitor
    - 不意の客 phrn. an unexpected visitor
  - L:
    - 招く まね・く[2] v. invite
    - 招かれざる まね・かれざる adj. uninvited
    - 不意 ふ·い [1][0] n. surprise, sudden 突然
- 挨拶 あい・さつ [1] n. greeting
  - F:
    - 挨拶する あいさつする v. greet
- 和^{▽}やか にこやか [2] n. a big smile
  - L:
    - にこやかにあいさつする phrv. greet (sb.) with a big/bright smile
    - にこやかな顔 phrn. a bright face
    - 顔 かお [0] n. face
- 午前 ご・ぜん [1] n. morning; a.m.
  - C:
    - Comment 1
    - Comment 2
  - E:
    - 午前八時ごろ起きます。 I wake up around eight a.m.
  - L:
    - 昼前 ひる・まえ [3] n. late morning 上午
    - 午前零時三分 ごぜんれいじさんぷん n. 00:03
- 昼間 ひる・ま [3]/ちゅう・かん [0] n. daytime 白天
  - C: The pronunciation ちゅうかん is less common and typically used in formal, technical contexts or used to form compound words.
- 日中(1) にっちゅう [0] n. daytime 白天
  - L:
    - 日中(2) にっちゅう [[cl:485624x978.wav][⏯]] n. 日本和中国

** Sentences
:PROPERTIES:
:CUSTOM_ID: 202410092201
:END:

A *Sentence* list uses this format:

#+begin_example
- [<audio>] [<speaker>] <entry> [<translation>]
  - [<notes>]
#+end_example

- =audio=: The audio of the entry, if any.
- =entry=: A sentence in the original language, such as Japanese. It must end in
  one of these punctuation marks followed by at least one space: =.?。？/=. If you
  want to include these punctuation marks =.?。？= multiple times in the entry
  (i.e., multiple full sentences), you must use =/= at the end.

- =translation=: The translation of =entry=, in whatever language you're familiar
  with. It's optional in the sense that if the entry is a complex sentence that
  needs further explanation with the =notes= sublist (see below), it can or should
  be omitted from the same line of =entry= and put in the =T:= item of the =notes=
  sublist instead. If it's a simple sentence with no need of further explanation
  then just put it on the same line with =entry=, separated by at least one white
  space. If the translation is present on both the entry line and the =T:=
  sub-notes the =T:= sub-notes is preferred.

  Here is an example of a simple Sentence list:

  - みずです。 It's water.
  - みずとごはんです。 It's water and rice.
  - みず、ください。 Water, please.

  Note that the translation must be on the same line with the entry if not in an
  =T:= item, in case you have enabled ~auto-fill-mode~. Say, a list like this will
  produce erroneous result:

  #+begin_src org
  - 学生たちを引率して博物館に行った。 I led [took] a group of students
    to the museum.
  #+end_src

The =audio=, =entry= and =translation= combined is called an "entry line". There can
be multiple entry lines on the same item, say, to form a dialogue or a short
passage. If it's a dialogue each line must begin with a =speaker= which takes the
format "<speaker>: " where speaker is any string followed by a colon and a
space. For example,

- A: はなさんはイギリス人ですか。 Is Hana British?
  B: いいえ、ブラジル人です。 No, she's Brazilian.

You can disable this feature by turning on the variable
~organki/disable-multi-entry-lines~ and henceforth all lines of the same item are
treated as one entry line, in case of a conceptual conflict between this feature
and ~auto-fill-mode~. <<TOKYO20251107203643>>

Alternatively, you can put the entry lines in the =M:= sub-notes of =notes=. See
below.

- =notes=: The notes sublist contains further explanation for the entry, which is
  composed of the following sub-notes. The notes sublist and the sub-notes are
  all optional.

  - P: <pronunciation>

    How to pronounce this entry. For Japanese entries, it's composed of these parts:
    : [<hiragana>] [<audio>]

    - =hiragana=: The hiragana reading of the entry. This is only necessary when
      the entry contains Kanji.
    - =audio=: The audio of the reading.

    Both parts are optional.

  - T: <translation>

    The translation of the entry in the languages you're familair with.

  - M: <multiple entry lines>

    A sublist where each item is an entry line. This is useful when there are
    multiple entry lines for the current item and you want to make SPR (see
    below) out of them.

  - V: <vocabulary>

    A [[#202410092157][Vocabulary]] sublist related to =entry=, the items of which will also be
    imported. If the parent item contains only one entry line, it will be used
    automatically as an example for these Vocabulary items, so that for example,
    it is displayed under the "Examples" sub-notes in their "Notes" field. This
    is called Automatic Parent Reference (APR). Only the first-level items have
    APR if the sublist is a multi-level list. This is because typically the
    first-level items are supposed to be contained in the parent item (i.e., a
    sentence and the new words it contains) while the nested items are not
    necessarily so, and you only want to see the contained vocabulary of a
    sentence after importing.

    If the parent item contains multiple entry lines you can use Selective
    Parent Reference (SPR), which makes reference only to the selected lines by
    utilizing the following specifications in the =S:= sub-notes of each
    Vocabulary item. The indices start from 1 in accordance with the numbering
    of items in ordered lists.

    - =:L (<indices>)=: The lines to be referenced. Each line is treated as an
      example.

      - =:L=: A keyword short for "Lines".
      - =(<indices>)=: The indices of the lines to be referenced in the parent item.

    - =:G ((<indices>)...)=: The groups of lines to be referenced. Each group of
      lines together is one example. This is useful for generating multi-line
      examples such as dialogues.

      - =:G=: A keyword short for "Groups".
      - =((<indices>)...)=: The groups of indices of the lines to be referenced.

    The specs only tell the =S:= sub-notes which lines to select and do not affect
    its other aspects.

    If there isn't any SPR specs APR will be in effect.

    The example below says selecting the 1st line, the 1st and 2nd line, the 6th
    and 7th line from the entry lines as examples for the current Vocabulary item.

    #+begin_example
    - S: :L (1) :G ((1 2))
      - :G ((6 7))
    #+end_example

    The entry lines can be specified in =entry= or the =M:= sub-notes. If both are
    present =M:= is preferred and =entry= is ignored.

    You can specify lines or groups repetitively under different Vocabulary
    items of the same entry lines. The effect is that for an example which are
    repetitively specified, all the Vocabulary items specifying it are
    accumulated into its =V:= sub-notes, and it will be imported only once.

  - C: <comments>

    A single line or sublist explaining the entry.

Here is an example of a comprehensive Sentence list:

1. どれが欲しいですか。 Which one do you want?
2. A: いつにほんへきましたか。 When did you come to Japan?
   B: 四月に日本に来ました。 I came to Japan in April.
3. 彼らは来るでしょう。
   - P: かれらはくるでしょう。
   - T: They will probably come.
4. この辺は木も多いし、たぶん昼間も静かだろう。
   - P: [[cl:202410021635.m4a][⏯]]
   - T: This area also has many trees and it’s probably quiet in the daytime.
   - V:
     - 辺 へん [0] n. side 边; nearby 附近
     - 木/樹 き [1] n. tree
     - 昼間 ひる・ま [3] n. daytime 白天

5. [[cl:202410021528.m4a][⏯]] あしたもきっといい天気だろう。 The weather will probably be nice tomorrow, too.

6. [[cl:202410271111.m4a][⏯]] A: 君も行くだろう？ You’re also going, right?
   [[cl:202410271112.m4a][⏯]] B: はい、もちろん。 Yes, of course.

7. Asking about years (This line is ignored.)
   - M:
     1) A: 何年ありますか？ How many years are there?
     2) B: 3年あります。 There are three years.
     3) A: 何年そのことをしていますか？ How many years have you been doing this?
     4) B: 10年しています。 I have been doing it for 10 years.
     5) B: かれこれ10年です。 Nearly ten years.
     6) A: それから何年経ちましたか？ How many years has it been since then?
     7) B: 5年経ちました。 It’s been five years.

   - C: Asking about years.
   - V:
     - 何年 なんねん [1] int. which year, what year; how many years
       - C: Asking about years.
       - E: :L (1 3 6)
       - S: :L (1) :G ((1 2) (6 7))
         - :G ((3 4) (3 5))
         - :L (3)
     - かれこれ [1] adv. almost, nearly; pron. this and that
       - A: 彼此^{▼}
       - S: :G ((3 5))
     - それから [0] conj. then 然后; since then 从那以后
       - C: Asking about years.
       - S:
         - :L (6) :G ((6 7))
         - 彼は夕食を食べて, それからすぐ寝た。
           - T: He had dinner, and then went to bed.
           - V:
             - 夕食 ゆうしょく [0] n. dinner
       - L:
         - そして [0] conj. and
     - 経^{▽}つ たつ [1] v. (time) pass

** Properties
:PROPERTIES:
:CUSTOM_ID: 202410211926
:END:

*** Properties and their scopes
Both Vocabulary and Sentence lists have properties such as deck, notetype, and
tags, etc., which specifies which deck the notes will be imported to, the
notetype and tags of the notes, respectively.

You can specify the properties during exporting, but a better way is to give
them default values before exporting to save you from entering them
repetitively, which are specified in the following ways and scopes:

- For all lists in the current buffer

  You can set the default values for the whole buffer with these in-buffer
  settings:

  #+begin_example
  ,#+ANKI_DECK: English
  ,#+ANKI_NOTETYPE: Vocabulary
  ,#+ANKI_TAGS: Fujisan
  #+end_example

- For all lists under a subtree

  You can also set them for a subtree only in a property drawer such as:

  #+begin_example
  ,*** Headline
  :PROPERTIES:
  :ANKI_DECK: English
  :ANKI_NOTETYPE: Vocabulary
  :ANKI_TAGS: Fujisan
  :END:
  #+end_example

  Headline tags (as entered with ~org-ctrl-c-ctrl-c~) are also treated as part of
  the Anki tags.

- For a certain list

  You can set the default values only for a certain list in a tag line named
  ~#+ATTR_ANKI~ directly over the list, values in the format of a plist, such as:
  <<20250928093631>>

  : #+ATTR_ANKI: :deck "English" :notetype "Vocabulary" :tags "tag1 tag2"

  You can also put the tag line over a sublist and it is effective when you make
  an active region over its items. If the tag line occurs multiple times on the
  different levels of a list it's always the closest one to the active region
  being adopted.

Specifications of different scopes can coexist and in this case if notetype and
deck occur several times in the subtree and its child subtrees, the one closest
to the list takes precedence. For tags all occurrences from all scopes are
accumulated and transformed into a tag tree as seen in the Anki browser with
respect to the hierarchy of the scopes (actually a Cartesian product, if you
know what that means).

Take this subtree for example,

#+NAME: organki-example-properties
#+begin_src org
,* Japanese :JP:
:PROPERTIES:
:ANKI_NOTETYPE: Vocabulary
:ANKI_DECK: Japanese
:ANKI_TAGS: JLPT
:END:

,** Date & Time :Date:Time:
,*** Vocabulary
:PROPERTIES:
:ANKI_NOTETYPE: One Entry One Card
:END:

,#+ATTR_ANKI: :deck "Japanese2" :tags "elementary"
- 今日 きょう [1] [[cl:106329x1268.wav][⏯]] n. today 今天
- 午前 ご・ぜん [1] n. morning 早上
- 午後 ご・ご [1] [[cl:330479x304.wav][⏯]] n. afternoon 下午
#+end_src

The notetype and deck of the imported notes would be "Vocabulary" and
"Japanese2" respectively, and they would have a tag tree like this:

#+begin_example
- JP
  - Date
    - elementary
  - Time
    - elementary
- JLPT
  - Date
    - elementary
  - Time
    - elementary
#+end_example

*** All the properties
:PROPERTIES:
:CUSTOM_ID: 20251126121234
:END:
The properties follow the naming convention that the in-buffer settings, drawer
properties, and tag lines all have the same core names but slightly different
alteration adjusted to the corresponding scope. For example, here is how the
property ~deck~ is specified in each scope:

- As an in-buffer setting: =#+ANKI_DECK: <value>=
- As a property in a property drawer: =:ANKI_DECK: <value>=
- As a property in a tag line: =:deck "<value>"=

Thus in the following list only the core names of the properties are mentioned.

- ~deck~: The deck to which the notes will be imported.
- ~notetype~: The notetype in which the notes will be imported.
- ~tags~: The tags of the notes.
- ~outdir~: The output directory where the generated files are placed.
- ~newlines~: Set the variable ~organki/preserve-newlines~.
- ~dmel~: Set the variable ~organki/disable-multi-entry-lines~.

** Exporting and Importing
:PROPERTIES:
:CUSTOM_ID: 20251126120339
:END:
To import a Vocabulary or Sentence list to Anki you need to first export it to
the format suitable for importing to Anki, that is, put the cursor anywhere in
the list and then call ~organki/import-region~ (=M-m m i=). The list will be
exported to a file or files with the naming "import<timestamp>.txt" under the
default directory (=~/Downloads= by default, customizable through the variable
[[#20251126121234][outdir]]) immediately.

You can also export part of the list by selecting the items in a region. Only
notes fully falling into the region are deemed "selected".

You can change the notetype, deck, tags, and output directory for the current
call by passing a universal prefix argument (=C-u=). Their default values (if any)
will be indicated in the prompt line.

When importing the generated file to Anki you can choose the Import option
"Existing notes" in the "Import File" window to decide what to do with the
existing notes - Update, Preserve, or Duplicate. It is recommended to always use
"Duplicate" so that the existing notes would not be overwritten without notice,
unless you're absolutely sure that those notes should be updated immediately.

The scope for duplication detection should be within all notes of the same
notetype, i.e., Notetype for Match scope. The idea is that there should be only
one note for an entry in a notetype no matter which deck it belongs to so that
you don't have to go through multiple memory sessions for the same entry. If
duplicates are found for a note you should examine and decide how to deal with
them.

[[i:20241019091112.png][screenshot]]

If the list doesn't have the default notetype, deck, or tags as described in the
[[#202410211926][Properties]] section, and you also didn't enter them when calling the function,
then the generated file or files would contain no such information, and you need
to choose them manually in the "Import File" window when importing to Anki.

[[i:20241019090928.png][screenshot]]

*Which notetypes can you import the notes to?*

Technically any notetype that has the same fields and order of the fields as
Vocabulary and Sentence - as specified in the previous sections - can be used
for importing the notes. In this case you're free to use any notetype name as
you like.

*Options*

You can use the following options to control certain aspects of the generated
contents. Check their docstrings for more detailed descriptions.

- ~organki-toggle/import-region-open-files~

  Whether to open the generated files automatically.

- ~organki-toggle/disable-tags~

  Whether to disable tags.

- ~organki-toggle/use-headlines-as-tags~

  Whether to use the headlines themselves as tags.

- ~organki-toggle/import-region-disable-APR~

  Whether to disable Automatic Parent Reference. If it is disabled the generated
  children will have no reference to the main entry.

- ~organki/convert-list-to-type~

  Which type of content should the plain lists be convert into. This is used to
  convert any plain list without a special meaning such as one present in a
  comment. The default value is nil, which is to convert them to the HTML
  format, and if it is ~text~ convert to a plain text format which preserves the
  indentation of the original lists.

- ~organki/disable-multi-entry-lines~

  Disable the [[TOKYO20251107203643][multiple entry lines]] feature when non-nil so that all lines of the
  same item are treated as one entry line, in case of a conceptual conflict
  between this feature and ~auto-fill-mode~.

** Normalizing & Prettifying
Organki can prettify the Vocabulary lists and Sentence lists to increase visual
clarity.

[[i:20241109160431.png][Image: Original list]]

[[i:20241109160353.png][Image: Formatted list]]

- ~organki/format-region-pretty~: Format the Sentence list in the region from
  START to END to a prettified version.
- ~organki/prettify-region~: It's the same as ~organki/format-region-pretty~
  visually but it doesn't change the original content. If ARG is non-nil revert
  to the original.

# todo
- Normalize lists

* Developer Guide
Organki uses the plain text format exported from Anki for importing.

[[i:20241019090828.png][screenshot]]

In the file beginning there's a comment section where the columns of the
notetype, deck, and tags of the notes are specified.

#+begin_example
#separator:tab
#html:true
#notetype column:1
#deck column:2
#tags column:6
#+end_example

** Testing
You need to write ERT tests before submitting pull requests. The following is
how I did the tests.

*** Automatic tests
The main entry point for testing is ~organki/import-region~, that is, you can call
it with some inputs and then compare the outputs with your expected ones. This
process can be done in a semi-automatic fashion with the assistance of
~organki-test/run-tests-in-file~. You only need to write your test case as a
subtree in an Org file under the directory =test/resources/= and put the inputs
and expected outputs in the subtree, and then evaluate =test/test-runner.el=, no
code writing during the process.

**** Inputs and outputs
To be specific, a test case or scenario is titled with a headline, under which
there are inputs and outputs of the concrete tests. The inputs are written as
plain lists, and the outputs of an input are presented in example blocks
following the list until another list.

An input can have multiple outputs and there is an ambiguity about it. Since
~organki/import-region~ returns an alist which may contain multiple files we may
say an input produces multiple outputs, which is different from what we are
talking about in a test scenario, where if an input has multiple outputs each
output corresponds to the whole result returned from a single call to
~organki/import-region~, multiple or not. Thus such an output may refer to one or
multiple example blocks and we say it's a *composite output*. To compose such an
output add the ~:composite~ keyword to the [[TOKYO20251001193545][#+ATTR_ARGS]] of each component output.
<<TOKYO20251001193106>>

The input and its outputs can be in different files — say, when you want to test
the integrity of an example input in the user manual but don’t want to keep the
outputs there, but instead in another designated test file. In this case it's
required that the input has a ~#+NAME~ tag line and each output use the ~:input~
keyword in its [[TOKYO20251002095718][#+ATTR_ARGS]] to refer to that input. This also works when the
input and outputs are in the same file, which provides another way of
pinpointing them besides implicit inference. <<TOKYO20251002100052>>

The input can also be an org source block, i.e.,

#+begin_example
,#+begin_src org
input
,#+end_src
#+end_example

In this case, the ~:points~ and ~:regions~ refer to the positions starting inside
that block, or the sub-editing buffer opened by =C-c '= (~org-edit-src-code~). See
[[#20251001192933][test parameters]]. <<TOKYO20251003200457>>

**** Test parameters
:PROPERTIES:
:CUSTOM_ID: 20251001192933
:END:
A ~#+ATTR_ARGS~ tag line is used above an input or output to store parameters
relating to that test. Its value takes the form of a plist, just without the
outer brackets. Here are two basic parameters:

- ~:points (1 10 ...)~: For output, meaning run test against the output with point
  at these positions respectively.
- ~:regions ((1 10) (2 8) ...)~: For output, meaning run test against the output
  with these regions selected respectively.

If neither of them is supplied the ~:begin~ of the input is used as a point.

Multiple ~#+ATTR_ARGS~ lines are also possible if you want to put the parameters
on separate lines.

Parameters used in the [[20250928093631][#+ATTR_ANKI]] line can be overridden by supplying them in
~#+ATTR_ARGS~.

A subtree, a plain list, or an example block can be marked not for such testing:

- A subtree is marked with the ~noauto~ tag in the headline.
- A plain list or an example block is marked with ~:test noauto~ in ~#+ATTR_ARGS~.

  If a list is marked then it is not treated as an input. The previous unmarked
  list continues to be the current input, and the subsequent unmarked example
  blocks are recognized as its outputs.

For testing backward compatibility with the old test cases as the program
evolves, a ~:bindings~ keyword is provided to the ~#+ATTR_ARGS~ line, which tells
the testing program to declare a predefined set of variable bindings before
generating the outputs. Its value is either a keyword or a list of keywords as
found in the plist [[help:organki-test--bindings][organki-test--bindings]].

The ~:composite~ keyword is used to mark an output as part of a [[TOKYO20251001193106][composite output]],
which takes one of the keys in the alist returned by ~organki/import-region~,
i.e., ~Vocabulary~ or ~Sentence~ (symbols). For all other parameters common to the
whole composite output, they are always found in the first component output's
~#+ATTR_ARGS~ line. <<TOKYO20251001193545>>

The ~:inputs~ keyword is used to pinpoint other inputs besides the default one by
referring to their names specified in the ~#+NAME~ lines. If the inputs are in the
same file you simply provide their names (as double-quoted strings), and if [[TOKYO20251002100052][in
different files]] you should use the format ="<file>::<name>"= where =file= is the
input's file path, which can be absolute or relative. If it's relative, you can
prepend it with a =r:= to indicate relative to the project root, otherwise
relative to the current directory. <<TOKYO20251002095718>>

You can't refer to a plain list as an input in ~:inputs~ since the ~:points~ and
~:regions~ are absolute positions for the default plain list, which contradicts
with other plain lists as inputs. They are only relative when the default input
is a source block or doesn't exist. In practice, you can use ~:inputs~ when:

- The default input and the other inputs are all plain lists and there is
  neither ~:points~ nor ~:regions~ specified.
- The default input and the other inputs are all source blocks and in this case
  ~:points~ and ~:regions~ are applicable.

**** A minimal example
Here is a minimal example of such a test. See the test files under
=test/resources/= for the usage in action.

#+begin_example
,* Test case 1

Description of this test.

- 今日 きょう [1] [[cl:foo.wav][⏯]] n. today
- shell membrane [abc] [[cl:foo.wav][⏯]] n. 蛋壳膜

,#+begin_example
#separator:tab
#html:true
#notetype column:1
#deck column:2
#tags column:3
Vocabulary	Test	tag1 tag2	今日	きょう [1] [sound:foo.wav]	n.	today	
Vocabulary	Test	tag1 tag2	shell membrane	[abc] [sound:foo.wav]	n.	蛋壳膜	
,#+end_example

# No testing for this output.
,#+ATTR_ARGS: notest
,#+begin_example
Some output.
,#+end_example
#+end_example

*** Writing your own tests
You can always write your own tests if they can't be done in the automatic way.
However, there are some conventions to follow for this project.

If you're to run a test with the entry point ~organki/import-region~, you can
write the inputs and outputs similarly to the automatic way. The differences are

1. An output must have the ~#+NAME: <unique name>~ line.

Then you just call ~organki-test--run-example~ with that name in your ERT test.
